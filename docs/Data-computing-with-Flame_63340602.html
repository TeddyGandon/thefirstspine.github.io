<!DOCTYPE html>
<html>
    <head>
        <title>Tech : Data computing with Flame</title>
        <link rel="stylesheet" href="styles/site.css" type="text/css" />
        <META http-equiv="Content-Type" content="text/html; charset=UTF-8">
    </head>

    <body class="theme-default aui-theme-default">
        <div id="page">
            <div id="main" class="aui-page-panel">
                <div id="main-header">
                    <div id="breadcrumb-section">
                        <ol id="breadcrumbs">
                            <li class="first">
                                <span><a href="index.html">Tech</a></span>
                            </li>
                                                </ol>
                    </div>
                    <h1 id="title-heading" class="pagetitle">
                                                <span id="title-text">
                            Tech : Data computing with Flame
                        </span>
                    </h1>
                </div>

                <div id="content" class="view">
                    <div class="page-metadata">
                        
        
    
        
    
        
        
            Created by <span class='author'> Teddy GANDON</span>, last modified on Jan 21, 2021
                        </div>
                    <div id="main-content" class="wiki-content group">
                    <h2 id="DatacomputingwithFlame-AboutFlame">About Flame</h2><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence"> (        (                      *             
 )\ )     )\ )       (         (  `            
(()/(    (()/(       )\        )\))(      (    
 /(_))    /(_))   ((((_)(     ((_)()\     )\   
(_))_|   (_))      )\ _ )\    (_()((_)   ((_)  
| |_     | |       (_)_\(_)   |  \/  |   | __| 
| __|    | |__      / _ \     | |\/| |   | _|  
|_|      |____|    /_/ \_\    |_|  |_|   |___| </pre>
</div></div><p>Flame is a containerized  collection of data computing &amp; analysis commands on the TFS collected data. These CLIs are served by Google Python Fire.</p><p>More on Google Python Fire: <a href="https://github.com/google/python-fire" data-card-appearance="inline" class="external-link" rel="nofollow">https://github.com/google/python-fire</a> </p><h2 id="DatacomputingwithFlame-Synopsis">Synopsis</h2><iframe
              src="https://viewer.diagrams.net/?highlight=0000ff&amp;edit=_blank&amp;layers=1&amp;nav=1#R7VvZltpIEv0anzPz4D5aqeIREAWq0VIUYpFe%2BkhCJbQhNQi0fP3c1AKiKJfdPXbbPbaP7VJG7jduRkaE0x%2FYUZRP9mayleONE35gqE3%2BgRU%2BMAzNMcwH8pvaFLXkrs%2FVAnfvbZpGF8HcK51GSDXSo7dxDlcN0zgOUy%2B5FtrxbufY6ZXM3O%2Fj7LrZSxxez5qYrnMjmNtmeCtdeZt0W0vvmbuLfOp47radme7165rIbBs3OzlszU2cdUTs%2BAM72sdxWn9F%2BcgJCXgtLnW%2Fh0%2FUnhe2d3bpl3RgY2%2F5%2BDJdzQtmYi4ta55K0sdmsSczPDYb%2FsD0Qow3fIkxLME1jPdVTe%2BPI1nq8APDcszdnWV1RT2X%2FMz2XgplERW1w2A99Uh1iwaKtGjxdTaAuynG%2B3Qbu%2FHODMcX6XAfH3cbh2yCQunSRorjBEIaQt9J06LhjnnE5Oxwm0ZhU%2BvkXrom3X%2Fjm5LeDEa%2BhbxbKNrCLt0XnU6kqLfjkcKlW1Vq%2Bx3SfRw4ozNoLVRtTcshpkG4bbmLd84Znq5OGzUf4uPedt5RJM02h8Pcu076TsP7uh3BvTNDQ5mJE0cO9oMGeyc0U%2B90fQzM5jS553bnrk%2BxVxGmPflsQ%2Fvm3HP31PUQ9Y6aXhfa4qOzjIuoIvOfIDZ991WZvTkmoWebFbt%2FOGLTXVqfSf45Yndp3WH5j0bs%2By%2FkNd372sS%2BouSf5d%2F9Df0EMzXJhp39ydnf0MU8JPX19eLlhBPDxNl7WIpDQMR8uO%2Bcp4uoSwMz9Nwdvm1gW9WdbxqiuI152J5J1tVMo8PhEPLQtJxwaNqBW5Gy0%2BSl%2BtV0bZhIEyUfEtP2dq5WcZWFwIuqq7T9KXiRC%2BRCD6fpwbMi%2FL2pEKh%2B%2FE5g8Gzn8Nvh5LYLeIoPXurFV3sBVikOXii9apCSec%2B1gwYCK07TOHqPb6SHk79LkLaWurZgbGvBsosf0GtE244L0KO%2BEaVaE9%2Fh1LxG8adkk5nUJhl8gFF%2B2B93KfbzmljfgAg8w39fIrDcV73bkiN0%2Bute%2B7sdtq9%2BX73tiPUY6jfq8uueu3bL6Fckre%2FZb%2BeW9T53L%2FbMiFj2nXUgP%2FZOdch%2FSgP3z7ou2d6Pdl3eumA3NILqkxr8Whmfgu8M1Bdo%2FjXINfQ3hK2mHLRSqsOESu%2FsoC4yD0TjzDAHf5nR01RhjGLIWav8aJeUZ06fKVuITxK7YTcFz8oFf7Ij%2ByT7g0we9ctNZHvidJtaE75UI8V%2Fmj%2FGm%2Blzpnr3J519DPX1c7KJlr7F0KnF8KUU9Quj6B%2FtQu70e77qZ0%2BXhTWq5zEm8slY5aG1Wh43U%2Fkkz7lcKkTXmdAHayf3zBW%2Ftxlla08WfTHaUpvpoCcVfazWPnbqjhb7uJMYfotxSnvy4Btr%2BdSpv6xl9xgY%2Fjv71gJend9nsnePHdCFMdFTmw2Pm8kDJ634UuyszWb6gbkeYg9Bd22lxTwn9gR1c7602GWhM8uIrM%2BY80djPTs9PzyPJVZBvzAjbSVtcDSmz4HotXpJCO43%2B92Ucr3PUsxkYXCyWWOHPrGxCnfmdNYXfZFWdkMOssQQKG9BG9NF1D9tRqILHRU2E54s7J1gjDaMuVqys6jPPc3FTBQGruwvGFHAGB7aM2GwmbiXMX3u3pgsI7uox66%2BywUllwtPKlHXyK3JA2%2Bsxbxq37Ytx7Sijcm6KDt6ONqMAaypvrh7LnRgij6UMXcLyQ9yVRizSjk%2BSJp8VEqbV%2Fyg%2BM9cBH%2BfpsMtVuRWs8wHuezPjqoQ5Bj5oAg6Wo9LuRxQ2MlB1uxM8lH2bZbsxlwBnV3VH%2B3FQp2Lrs0%2B81bFKiOxJllPLF1OZ54jw08jc5UfpFU%2F01dKspkGPVlrZOtHGn16xtoIragfGEJabqaPJ5NZdPu3srRBsYfTdIf5CotJQ2mVJxZOjL4e9OyoT1vR7HXdHxYTHtWITjaTZaGyClDr7405nZrr59CO0GYVUqrf7fe8tZnt1t49bh0tOeIkhp1%2BJ3Ii0JdX%2FXGlLZQpczQMcCoVaBxs53JFmHGKl3FKweVgVwF8XUVYHPGHU0o3l6CZqp2vM%2FL8LUwpGhrG3sODoUHrUXiwhNhXha1vTIxIZSqcUwt3qc6ElKPFeSuzd0v0SUKwFGt%2FDs5r1zr9L%2FthzdUzZQpxIV%2Fwx%2BkOj8YKp11ICpy6o3FTl8AicD2CHRjawa7GGW2A76yndPoZk4fSnDwUYC2vRvzJihadfh1%2BzMXTk59nsIaxOAEuAdVgFzCqNuAlwWUkX6ZVQWbVObAVxKOsuYWqBYSrueTPCkWwmfbkVvoRxrTsi7ykLVJ59IuvF74GPM42g7POSYIO7OwMdoBXGpug%2BANeKWcH4H7EH7RzYdWA5YjLFE2n0AeWZkypwoCWixseV9x%2BjTWwOxraT4VzWuMswha4tAQbocy5Qi7tUhkNCnxTsLkM7EUq%2BwG4HLByGZAbBJyfMYq%2FOMi%2BC5u84ORy5omTkIxZnQ9ZWxSKP06JXf6FM8F5DJvAMeBurowyBt%2B0TGTC2JW0Mbi6QJ0MHciwIXqpEO7OByXsNOQuq44yFnLYFpG%2FtR84HxrxfhTKgZeF%2BSocW1tW2ejR1fpaWbFBezVaMsaKh6dy2avqyZw6UQIj0i%2F7X28SeDCx6otZZ98HeGChzjxk8LpOmxUfvK4zo35i%2BUmNa0dvtY1%2BRBvoQIipTr9AXyuxvn4s9HXQ8uXSr3O3iN79rdcAywu%2FAqwGe2F5ZyUsAauA4eKIKlVYCFkIcBsSRGelKtg0tEOsBSf7%2BFlpYEZuwOJtpMe%2FkK6Q1uYDtrIRfoDzbwNpl5J8l4aN4EXB5SR%2FAN9szIG70IR7xDf4vnAV2GxFALeFMQN%2Fg4LNhucY0G%2F4cLDTFHfrbzRn76fzNeyjXIol%2FAr4GuNc8XDXwVarowEHPcAvhv0WxtAD7kzYEBV3oCjYZXUPakEBO058O%2Fh8JLIYv2mvyV35s9pribEJw0f93ZOfVXHXk0uCdvL7q6Q%2B%2Bp9PfbBvpD7Yb5X6aDMd76U%2BSAIj%2BfLNn19YmFY7AvU%2BKL3XWfPvnQ96663D6%2BR2nTkkTxm2XurME7PK4WZ7M7lOIr6RCr7OJDfCFy8MO0mi8aA37PXeZN37ivw8F78XrK1af6XZ2hTVllzZ%2B27KDL1YaWc36bX7HEabl9i63XUKaJHLdQrocjGu%2BK0e5TB6j7gM011jRGG8l2yV9hkhENJEXL7jQi2%2BLFVE2ooC5rpKFZ3nxr6znl1dvgtyaRfGWgntnRGirroYsDfWnOByrFM7E7u%2B3iPlZK2HL46wnKzLgIWZPmHFIbCpW1VuxmOoszPXnCwTg9lSWBElFxwQIQnH2jkiMrjHcKN1yKokVgG3mgdqKAcoj0k9rrs6eWXjetmMuijO4PTpxJ1urn%2FKI1cs3BMSohMUChL2EC2gzKNMNIIwaEy3ztBfWeUYvOA4OE1%2FapUkYL3oYAbXdZEpJE2JVSNAgMsqtuPxQAGOgPyp8eAQ6Aju3hjPa8eDg%2BGTFCnK4JaqzYCC%2FZd2vWh3naOM8NH933fdrlIjro3LtKskSV24nFjLjetEKaVOQtYcIW5O0FG1pQ9HPiPpGknTye4KSZMpEgpL0DHcVRYhFQnLEIJRDHFllUhO4T6VSgk3SYMr5s%2F4OnTD6S6okrhWaFtUoV3pplVqqHQLa0TlVVrCFxEOcwxxgcXRwIWchHpw3bKm%2FpGsCXsSCyKruIy%2B6MNhvgPcYZIKZST8ROjNSYKN9eqZjHUpZG5NPEAPWJ%2BN9SEs12YIJ22yN67em01SfySM5NSFWxB9KJpdrUWv9ijSCIpKjAVLMT4oI5IGDA4qgim1GkvOK%2BbAnZeBGc5Jrpci2QMjF1kJK0JXaVpfJ8FXKQmVvhD2kvYu1g6MW9lKhkzGWRIpqUrlYl8kdJhTNEk%2FysLsgHCY4F5AltepX71eazmmoTdOnmfQn0jCCwpBHUJj9CE4ljLWAOwRemDf0M%2BMkxmy9gFL8AQOvFJkBA9wheJJPcbAXGOcKOgKWKrag0xSdaijME8hk3MvBLTj1dyymJw3mP5RnA7JP0BQxPrLJAWIOYFxbSeEWYnAMoMeyV4PF34OENaAB6NuO5Li0qFTnKU5OScztzNeAbce%2B5cpsv93TiFhVxWefvEpvLIVXQc43zXhgayvw9AO79sAsL7H8PVN3JPzg%2BArp5C%2B9Qm5N5wX7ps5L3ff833D%2F%2FeD1Mbd%2Fqc93GPbCOj2cc0hMXdXZGlf0jTPbQZkka71L3j4xCvG%2FBRNYGi%2F7%2B%2F%2BTQoEVYpg%2FfHFjLywqDueXz5ARyxHCOOEJyetHj%2B8qrke5FDRjAxBM0n%2Bqq5eKqncxfvIDK%2Brs%2BaMkXqOvHJqKkPQ19l%2FbN4svNkf5z396OEc7Jr%2BVGfuqjLdm7vDC3q1%2FUGotkEW7zfXw3e7W2fH%2F%2BMrZBmeP8P56vsC7cY7JKHZwOrtQq8z8UsYm2l3Qa8fQz2EZuTU0W5qoue%2B8y6q1v8n3kWRPf%2BluPHmPcrXyEjwr4LvNzIS928YWuYrGFr3bjsYM%2FrvFquOH1ZpbxXcex9vD9U8jfdV5PXzvux58ULn972TkAA43hc%2F7tueHvO3ve0hLznP%2FyWmfnV2%2BY9F7Pi%2F"                                                           width="100%"                                          height="400"                       frameborder="0"       sandbox="allow-forms allow-modals allow-orientation-lock allow-pointer-lock allow-popups allow-popups-to-escape-sandbox allow-presentation allow-same-origin allow-scripts allow-top-navigation-by-user-activation"
>
    <p />
</iframe>
<h2 id="DatacomputingwithFlame-Usage">Usage</h2><p>Flame is thinked to run along with docker: run an image on a mounted volume.</p><h3 id="DatacomputingwithFlame-Preparetheenvironment">Prepare the environment</h3><p>The machine that will run the flame container should have docker installed. Run this to install it:</p><p><code>apt-get update &amp;&amp; apt-get -y install docker-ce docker-ce-cli containerd.io</code></p><h3 id="DatacomputingwithFlame-Runthedockerimage">Run the docker image</h3><p><code>docker run --name &lt;some-flame&gt; -e FLAME_&lt;SOME_CONFIG&gt;=&lt;some-value&gt; thefirstspine/flame:&lt;tag&gt; &lt;the-command&gt;</code></p><p>For the latest version of flame, use the <code>latest</code> tag.</p><p>Example : <code>docker run --name my-flame-container thefirstspine/flame:latest python compute-games.py count_game_type</code></p><h3 id="DatacomputingwithFlame-Gettingoutput">Getting output</h3><p>The command will simply print on the standard output the result of the command.</p><h3 id="DatacomputingwithFlame-Dockerenvironmentvariablesconfiguration">Docker environment variables configuration</h3><p>Based on the environment variables passed to the container, some features will be activated or not. Hereâ€™s a list of all available features:</p><div class="table-wrap"><table data-layout="default" class="confluenceTable"><colgroup><col style="width: 254.0px;"/><col style="width: 253.0px;"/><col style="width: 253.0px;"/></colgroup><tbody><tr><th class="confluenceTh"><p><strong>Variable key</strong></p></th><th class="confluenceTh"><p><strong>Explaination</strong></p></th><th class="confluenceTh"><p><strong>Examples</strong></p></th></tr><tr><td class="confluenceTd"><p><code>FLAME_DB_URL</code></p></td><td class="confluenceTd"><p>The database Flame should connect to.</p></td><td class="confluenceTd"><ul><li><p><code>FLAME_DB_URL=mongodb://localhost:27017/database</code></p></li><li><p><code>FLAME_DB_URL=postgresql://localhost:5432/database</code></p></li></ul></td></tr></tbody></table></div><h3 id="DatacomputingwithFlame-Notes">Notes</h3><ul><li><p>Auto remove the running container using the <code>--rm</code> flag.</p></li><li><p>Output to a file: <code>docker run --rm -a STDOUT â€¦ &gt; myoutput.json</code></p></li></ul><h2 id="DatacomputingwithFlame-Availablecommands">Available commands</h2><p>The computing commands are available inside collections served by Google Python Fire.</p><p>To run a command: <code>&lt;collection&gt; &lt;command&gt; &lt;options&gt;</code></p><p>For instance: <code>games.py get_game --game_id=123</code></p><h3 id="DatacomputingwithFlame-Collectiongames.py">Collection games.py</h3><p>All the computations related with the games.  </p><p>Required database: <code>games</code></p><div class="table-wrap"><table data-layout="default" class="confluenceTable"><colgroup><col style="width: 254.0px;"/><col style="width: 253.0px;"/><col style="width: 253.0px;"/></colgroup><tbody><tr><th class="confluenceTh"><p><strong>Command</strong></p></th><th class="confluenceTh"><p><strong>Description</strong></p></th><th class="confluenceTh"><p><strong>Options</strong></p></th></tr><tr><td class="confluenceTd"><p><code>count_game_types</code></p></td><td class="confluenceTd"><p>Get the number of played games by types</p></td><td class="confluenceTd"><ul><li><p><code>String outputs_to</code><br/>Indicates the output format of the command. Must be <code>python</code> (default) or <code>json</code>.</p></li></ul></td></tr></tbody></table></div><h3 id="DatacomputingwithFlame-Collectionplayers.py">Collection players.py</h3><p>The commands under this collection are related with the player data.</p><p>Required database: <code>wizards</code></p><div class="table-wrap"><table data-layout="default" class="confluenceTable"><colgroup><col style="width: 254.0px;"/><col style="width: 253.0px;"/><col style="width: 253.0px;"/></colgroup><tbody><tr><th class="confluenceTh"><p><strong>Command</strong></p></th><th class="confluenceTh"><p><strong>Description</strong></p></th><th class="confluenceTh"><p><strong>Options</strong></p></th></tr><tr><td class="confluenceTd"><p><code>ranks</code></p></td><td class="confluenceTd"><p>Ranks the players according to their victories</p></td><td class="confluenceTd"><ul><li><p><code>String outputs_to</code><br/>Indicates the output format of the command. Must be <code>python</code> (default) or <code>json</code>.</p></li></ul></td></tr></tbody></table></div><h3 id="DatacomputingwithFlame-Collectionsessions.py">Collection sessions.py</h3><p>All the Solid Pancake sessions.</p><p>Required database: <code>solid-pancake</code></p><div class="table-wrap"><table data-layout="default" class="confluenceTable"><colgroup><col style="width: 254.0px;"/><col style="width: 253.0px;"/><col style="width: 253.0px;"/></colgroup><tbody><tr><th class="confluenceTh"><p><strong>Command</strong></p></th><th class="confluenceTh"><p><strong>Description</strong></p></th><th class="confluenceTh"><p><strong>Options</strong></p></th></tr><tr><td class="confluenceTd"><p><code>count_active_sessions_per_product_and_version</code></p></td><td class="confluenceTd"><p>Get the sessions in the Solid Pancake service tracking</p></td><td class="confluenceTd"><ul><li><p><code>String outputs_to</code><br/>Indicates the output format of the command. Must be <code>python</code> (default) or <code>json</code>.</p></li></ul></td></tr><tr><td class="confluenceTd"><p><code>count_sessions_per_product</code></p></td><td class="confluenceTd"><p>Count the sessions per product</p></td><td class="confluenceTd"><ul><li><p><code>String outputs_to</code><br/>Indicates the output format of the command. Must be <code>python</code> (default) or <code>json</code>.</p></li></ul></td></tr></tbody></table></div><p /><p />
                    </div>

                    
                                                      
                </div>             </div> 
            <div id="footer" role="contentinfo">
                <section class="footer-body">
                    <p>Document generated by Confluence on Apr 01, 2021 18:07</p>
                    <div id="footer-logo"><a href="http://www.atlassian.com/">Atlassian</a></div>
                </section>
            </div>
        </div>     </body>
</html>
